<section class="complaint-history">
    <section class="complaint-feedback flex-column">
        <div class="complaint-feedback__container w-100 flex-column">
          @if(descricao){
            <h2 class="complaint-feedback__title">Feedback do cidadão</h2>
            <span class="complaint-feedback__description w-100">
              {{descricao}}
            </span>
          }
          @else{
            @if(isAuthor()){
              <h2 class="complaint-feedback__title">Deixe seu feedback sobre a solução</h2>
              <form [formGroup]="feedbackForm" (ngSubmit)="sendFeedback()" class="complaint-feedback__form flex-column w-100">
                <textarea 
                  class="field__textarea" 
                  formControlName="descricao"
                  placeholder="Descreva sua experiência com a solução da denúncia" 
                  required
                  (input)="autoGrow($event)"
                  (keydown)="onFeedbackTextAreaKeyDown($event)"
                >
                </textarea>
                <button class="button button--tertiary" type="submit" [disabled]="feedbackForm.invalid">Enviar feedback</button>
              </form>
            }
            @else{
              <span class="complaint-feedback__description w-100">
                No momento nenhum feedback foi realizado pelo usuário que criou a denúncia
              </span>
            }
          }
        </div>
    </section>
    <section class="complaint-comments flex-column">
        <h2 class="complaint-comments__title">Histórico da Denúncia</h2>
        <div class="complaint-comments__comments flex-column">
          @if(comments.length === 0){
            <span>Inicie a conversa aqui</span>
          }
          @else{
            @for (comment of comments; track $index) {
                @if($index < MAX_COMMENTS){
                    <app-comment-card class="w-100" [comment]="comment"></app-comment-card>
                }
            }
          }
         
        </div>
        @if(comments.length > MAX_COMMENTS){
          <div class="flex-column">
            <span>+ {{comments.length - MAX_COMMENTS}} comentários</span>
            <button class="button button--primary">Veja o histórico completo</button>
          </div>
        }
        <form [formGroup]="commentForm" class="complaint__add-complaint flex-column" (ngSubmit)="sendComment()">
          <textarea 
            class="field__textarea"
            placeholder="Faça seu comentário"
            formControlName="newComment"
            (input)="autoGrow($event)"
            (keydown)="onCommentTextAreaKeyDown($event)"
            #commentTextarea
            required
          ></textarea>
          <button class="button button--primary" type="submit" [disabled]="commentForm.invalid">Comentar</button>
        </form>
    </section>
</section>
